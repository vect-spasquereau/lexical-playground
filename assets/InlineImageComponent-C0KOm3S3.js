import{r as s,u as A,o as B,a as N,D as R,p as v,f as k,j as L,I as _,J as C,P as $,h as J,i as U,d as z,c as e,C as M,T as O,S as W,m as q,B as G}from"./index-CVNstyPT.js";const D=new Set;function H(a){if(!D.has(a))throw new Promise(c=>{const o=new Image;o.src=a,o.onload=()=>{D.add(a),c(null)}})}function K({altText:a,className:c,imageRef:o,src:p,width:l,height:d,position:r}){return H(p),e.jsx("img",{className:c||void 0,src:p,alt:a,ref:o,"data-position":r,style:{display:"block",height:d,width:l},draggable:"false"})}function V({activeEditor:a,nodeKey:c,onClose:o}){const l=a.getEditorState().read(()=>M(c)),[d,r]=s.useState(l.getAltText()),[S,h]=s.useState(l.getShowCaption()),[x,i]=s.useState(l.getPosition()),g=u=>{h(u.target.checked)},j=u=>{i(u.target.value)},t=()=>{const u={altText:d,position:x,showCaption:S};l&&a.update(()=>{l.update(u)}),o()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"1em"},children:e.jsx(O,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:d,"data-test-id":"image-modal-alt-text-input"})}),e.jsxs(W,{style:{marginBottom:"1em",width:"208px"},value:x,label:"Position",name:"position",id:"position-select",onChange:j,children:[e.jsx("option",{value:"left",children:"Left"}),e.jsx("option",{value:"right",children:"Right"}),e.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxs("div",{className:"Input__wrapper",children:[e.jsx("input",{id:"caption",type:"checkbox",checked:S,onChange:g}),e.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsx(q,{children:e.jsx(G,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>t(),children:"Confirm"})})]})}function X({src:a,altText:c,nodeKey:o,width:p,height:l,showCaption:d,caption:r,position:S}){const h=s.useRef(null),x=s.useRef(null),[i,g,j]=A(o),[t]=B(),[u,y]=s.useState(null),E=s.useRef(null),P=N(),I=s.useCallback(f=>{const m=R(),n=x.current;if(i&&v(m)&&m.getNodes().length===1){if(d)return k(null),f.preventDefault(),r.focus(),!0;if(n!==null&&n!==document.activeElement)return f.preventDefault(),n.focus(),!0}return!1},[r,i,d]),w=s.useCallback(f=>E.current===r||x.current===f.target?(k(null),t.update(()=>{g(!0);const m=t.getRootElement();m!==null&&m.focus()}),!0):!1,[r,t,g]);s.useEffect(()=>{let f=!0;const m=L(t.registerUpdateListener(({editorState:n})=>{f&&y(n.read(()=>R()))}),t.registerCommand(z,(n,b)=>(E.current=b,!1),C),t.registerCommand(U,n=>{const b=n;return b.target===h.current?(b.shiftKey?g(!i):(j(),g(!0)),!0):!1},C),t.registerCommand(J,n=>n.target===h.current?(n.preventDefault(),!0):!1,C),t.registerCommand($,I,C),t.registerCommand(_,w,C));return()=>{f=!1,m()}},[j,t,i,o,I,w,g]);const T=i&&v(u),F=i&&P;return e.jsx(s.Suspense,{fallback:null,children:e.jsx(e.Fragment,{children:e.jsx("span",{draggable:T,children:e.jsx(K,{className:F?`focused ${v(u)?"draggable":""}`:null,src:a,altText:c,imageRef:h,width:p,height:l,position:S})})})})}export{V as UpdateInlineImageDialog,X as default};
