import{o as q,a as j,r as n,C,$ as g,j as h,I as b,b as x,d as S,D as v,p as R,c as o,E as k,e as D,K as N}from"./index-CVNstyPT.js";function I({equation:i,inline:m,nodeKey:u}){const[t]=q(),c=j(),[s,p]=n.useState(i),[a,l]=n.useState(!1),E=n.useRef(null),f=n.useCallback(e=>{l(!1),t.update(()=>{const r=C(u);g(r)&&(r.setEquation(s),e&&r.selectNext(0,0))})},[t,s,u]);return n.useEffect(()=>{!a&&s!==i&&p(i)},[a,i,s]),n.useEffect(()=>{if(c)return a?h(t.registerCommand(S,()=>{const e=document.activeElement;return E.current!==e&&f(),!1},x),t.registerCommand(b,()=>{const e=document.activeElement;return E.current===e?(f(!0),!0):!1},x)):t.registerUpdateListener(({editorState:e})=>{e.read(()=>{const d=v();return R(d)&&d.has(u)&&d.getNodes().length===1})&&l(!0)})},[t,u,f,a,c]),o.jsx(o.Fragment,{children:a&&c?o.jsx(k,{equation:s,setEquation:p,inline:m,ref:E}):o.jsx(D,{onError:e=>t._onError(e),fallback:null,children:o.jsx(N,{equation:s,inline:m,onDoubleClick:()=>{c&&l(!0)}})})})}export{I as default};
