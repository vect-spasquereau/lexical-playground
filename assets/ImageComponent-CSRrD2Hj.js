import{r as u,c as a,M as Y,u as K,o as Q,a as Z,D as X,p as V,f as T,g as ee,j as te,I as se,J as k,P as ne,h as re,i as ie,d as oe,k as ae,C as U,l as F}from"./index-CVNstyPT.js";function _(v,g,c){return Math.min(Math.max(v,g),c)}const n={east:1,north:8,south:2,west:4};function ce({onResizeStart:v,onResizeEnd:g,buttonRef:c,imageRef:y,maxWidth:N,editor:I,showCaption:P,setShowCaption:j,captionsEnabled:z}){const M=u.useRef(null),w=u.useRef({priority:"",value:"default"}),b=u.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),h=I.getRootElement(),E=N||(h!==null?h.getBoundingClientRect().width-20:100),R=h!==null?h.getBoundingClientRect().height-20:100,m=100,H=100,s=e=>{const r=e===n.east||e===n.west,t=e===n.north||e===n.south,S=e&n.north&&e&n.west||e&n.south&&e&n.east,d=r?"ew":t?"ns":S?"nwse":"nesw";h!==null&&h.style.setProperty("cursor",`${d}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${d}-resize`,"important"),w.current.value=document.body.style.getPropertyValue("-webkit-user-select"),w.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},D=()=>{h!==null&&h.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",w.current.value,w.current.priority))},f=(e,r)=>{if(!I.isEditable())return;const t=y.current,S=M.current;if(t!==null&&S!==null){e.preventDefault();const{width:d,height:C}=t.getBoundingClientRect(),l=Y(t),i=b.current;i.startWidth=d,i.startHeight=C,i.ratio=d/C,i.currentWidth=d,i.currentHeight=C,i.startX=e.clientX/l,i.startY=e.clientY/l,i.isResizing=!0,i.direction=r,s(r),v(),S.classList.add("image-control-wrapper--resizing"),t.style.height=`${C}px`,t.style.width=`${d}px`,document.addEventListener("pointermove",L),document.addEventListener("pointerup",W)}},L=e=>{const r=y.current,t=b.current,S=t.direction&(n.east|n.west),d=t.direction&(n.south|n.north);if(r!==null&&t.isResizing){const C=Y(r);if(S&&d){let l=Math.floor(t.startX-e.clientX/C);l=t.direction&n.east?-l:l;const i=_(t.startWidth+l,m,E),$=i/t.ratio;r.style.width=`${i}px`,r.style.height=`${$}px`,t.currentHeight=$,t.currentWidth=i}else if(d){let l=Math.floor(t.startY-e.clientY/C);l=t.direction&n.south?-l:l;const i=_(t.startHeight+l,H,R);r.style.height=`${i}px`,t.currentHeight=i}else{let l=Math.floor(t.startX-e.clientX/C);l=t.direction&n.east?-l:l;const i=_(t.startWidth+l,m,E);r.style.width=`${i}px`,t.currentWidth=i}}},W=()=>{const e=y.current,r=b.current,t=M.current;if(e!==null&&t!==null&&r.isResizing){const S=r.currentWidth,d=r.currentHeight;r.startWidth=0,r.startHeight=0,r.ratio=0,r.startX=0,r.startY=0,r.currentWidth=0,r.currentHeight=0,r.isResizing=!1,t.classList.remove("image-control-wrapper--resizing"),D(),g(S,d),document.removeEventListener("pointermove",L),document.removeEventListener("pointerup",W)}};return a.jsxs("div",{ref:M,children:[!P&&z&&a.jsx("button",{className:"image-caption-button",ref:c,onClick:()=>{j(!P)},children:"Add Caption"}),a.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{f(e,n.north)}}),a.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{f(e,n.north|n.east)}}),a.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{f(e,n.east)}}),a.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{f(e,n.south|n.east)}}),a.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{f(e,n.south)}}),a.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{f(e,n.south|n.west)}}),a.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{f(e,n.west)}}),a.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{f(e,n.north|n.west)}})]})}const le="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e",A=new Map,J=ae("RIGHT_CLICK_IMAGE_COMMAND");function ue(v){let g=A.get(v);if(typeof g=="boolean")return g;throw g||(g=new Promise(c=>{const y=new Image;y.src=v,y.onload=()=>c(!1),y.onerror=()=>c(!0)}).then(c=>(A.set(v,c),c)),A.set(v,g),g)}function he(v){return v.toLowerCase().endsWith(".svg")}function de({altText:v,className:g,imageRef:c,src:y,width:N,height:I,maxWidth:P,onError:j}){const[z,M]=u.useState(null),w=he(y);u.useEffect(()=>{if(c.current&&w){const{naturalWidth:R,naturalHeight:m}=c.current;M({height:m,width:R})}},[c,w]);const b=ue(y);if(u.useEffect(()=>{b&&j()},[b,j]),b)return a.jsx(O,{});const E=(()=>{if(!w)return{height:I,maxWidth:P,width:N};const R=(z==null?void 0:z.width)||200,m=(z==null?void 0:z.height)||200;let H=R,s=m;if(H>P){const f=P/H;H=P,s=Math.round(s*f)}const D=500;if(s>D){const f=D/s;s=D,H=Math.round(H*f)}return{height:s,maxWidth:P,width:H}})();return a.jsx("img",{className:g||void 0,src:y,alt:v,ref:c,style:E,onError:j,draggable:"false",onLoad:R=>{if(w){const m=R.currentTarget;M({height:m.naturalHeight,width:m.naturalWidth})}}})}function O(){return a.jsx("img",{src:le,style:{height:200,opacity:.2,width:200},draggable:"false",alt:"Broken image"})}function me({src:v,altText:g,nodeKey:c,width:y,height:N,maxWidth:I,resizable:P,showCaption:j,caption:z,captionsEnabled:M}){const w=u.useRef(null),b=u.useRef(null),[h,E,R]=K(c),[m,H]=u.useState(!1),[s]=Q(),[D,f]=u.useState(null),L=u.useRef(null),[W,e]=u.useState(!1),r=Z(),t=u.useCallback(o=>{const p=X(),x=b.current;if(h&&V(p)&&p.getNodes().length===1){if(j)return T(null),o.preventDefault(),z.focus(),!0;if(x!==null&&x!==document.activeElement)return o.preventDefault(),x.focus(),!0}return!1},[z,h,j]),S=u.useCallback(o=>L.current===z||b.current===o.target?(T(null),s.update(()=>{E(!0);const p=s.getRootElement();p!==null&&p.focus()}),!0):!1,[z,s,E]),d=u.useCallback(o=>{const p=o;return m?!0:p.target===w.current?(p.shiftKey?E(!h):(R(),E(!0)),!0):!1},[m,h,E,R]),C=u.useCallback(o=>{s.getEditorState().read(()=>{const p=X();o.target.tagName==="IMG"&&ee(p)&&p.getNodes().length===1&&s.dispatchCommand(J,o)})},[s]);u.useEffect(()=>{const o=s.getRootElement(),p=te(s.registerUpdateListener(({editorState:x})=>{const G=x.read(()=>X());V(G)?f(G):f(null)}),s.registerCommand(oe,(x,G)=>(L.current=G,!1),k),s.registerCommand(ie,d,k),s.registerCommand(J,d,k),s.registerCommand(re,x=>x.target===w.current?(x.preventDefault(),!0):!1,k),s.registerCommand(ne,t,k),s.registerCommand(se,S,k));return o==null||o.addEventListener("contextmenu",C),()=>{p(),o==null||o.removeEventListener("contextmenu",C)}},[R,s,m,h,c,t,S,d,C,E]);const l=()=>{s.update(()=>{const o=U(c);F(o)&&o.setShowCaption(!0)})},i=(o,p)=>{setTimeout(()=>{H(!1)},200),s.update(()=>{const x=U(c);F(x)&&x.setWidthAndHeight(o,p)})},$=()=>{H(!0)},q=h&&V(D)&&!m,B=(h||m)&&r;return a.jsx(u.Suspense,{fallback:null,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{draggable:q,children:W?a.jsx(O,{}):a.jsx(de,{className:B?`focused ${V(D)?"draggable":""}`:null,src:v,altText:g,imageRef:w,width:y,height:N,maxWidth:I,onError:()=>e(!0)})}),P&&V(D)&&B&&a.jsx(ce,{showCaption:j,setShowCaption:l,editor:s,buttonRef:b,imageRef:w,maxWidth:I,onResizeStart:$,onResizeEnd:i,captionsEnabled:!W&&M})]})})}export{J as RIGHT_CLICK_IMAGE_COMMAND,me as default};
